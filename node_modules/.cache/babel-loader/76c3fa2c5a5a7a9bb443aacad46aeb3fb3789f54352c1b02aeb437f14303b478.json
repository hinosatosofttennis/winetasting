{"ast":null,"code":"import _taggedTemplateLiteral from\"/workspaces/winetasting/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral.js\";var _templateObject,_templateObject2,_templateObject3,_templateObject4;import React,{useState,useEffect,useCallback}from'react';import{fetchTastingRecords}from'../utils/Firestore';import styled from'styled-components';// ======================= スタイル定義 =======================\nimport{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const HistoryContainer=styled.div(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  padding: 20px;\\n  padding-bottom: 80px;\\n\"])));const SearchInput=styled.input(_templateObject2||(_templateObject2=_taggedTemplateLiteral([\"\\n    width: 100%;\\n    padding: 12px;\\n    margin-bottom: 20px;\\n    border: 1px solid #ccc;\\n    border-radius: 8px;\\n    box-sizing: border-box;\\n\"])));const RecordCard=styled.div(_templateObject3||(_templateObject3=_taggedTemplateLiteral([\"\\n    background: \",\";\\n    border: 1px solid #eee;\\n    padding: 15px;\\n    margin-bottom: 10px;\\n    border-radius: 10px;\\n    box-shadow: 0 2px 4px rgba(0,0,0,0.05);\\n    cursor: pointer;\\n\"])),props=>props.wineType==='white'?'#fff8e1':'#fbe5e7');const DetailList=styled.ul(_templateObject4||(_templateObject4=_taggedTemplateLiteral([\"\\n    list-style: none;\\n    padding: 0;\\n    margin-top: 15px;\\n    border-top: 1px solid #ddd;\\n    padding-top: 10px;\\n    font-size: 14px;\\n\"])));// ========================================================\nconst HistoryView=_ref=>{let{user}=_ref;const[allRecords,setAllRecords]=useState([]);const[filteredRecords,setFilteredRecords]=useState([]);const[searchTerm,setSearchTerm]=useState('');const[selectedRecord,setSelectedRecord]=useState(null);const[loading,setLoading]=useState(true);// 1. 履歴の読み込み\nconst loadRecords=useCallback(async()=>{if(!user)return;setLoading(true);try{const records=await fetchTastingRecords(user.uid);setAllRecords(records);setFilteredRecords(records);}catch(error){console.error(\"履歴の読み込みエラー:\",error);}finally{setLoading(false);}},[user]);useEffect(()=>{loadRecords();},[loadRecords]);// 2. 検索・フィルタリングロジック\nuseEffect(()=>{const term=searchTerm.toLowerCase();const filtered=allRecords.filter(record=>{const summary=record.concise_summary;// 検索対象フィールド\nconst searchableText=[summary.producer,summary.vintage,summary.type,record.wine_type// 白ワイン/赤ワイン\n].join(' ').toLowerCase();return searchableText.includes(term);});setFilteredRecords(filtered);},[searchTerm,allRecords]);// 3. 詳細レコードの表示レンダリング\nconst renderRecordDetails=record=>{if(!record)return null;// データをセクションごとに分類して表示\nconst data=record.full_tasting_data;const sections={};// { 'Appearance': { '濃淡': '淡い', ... }, ... }\n// フルデータからセクションを再構築するロジック (省略)\n// ここでは簡単にフラットリストで表示します\nreturn/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setSelectedRecord(null),children:\"\\u2190 \\u5C65\\u6B74\\u4E00\\u89A7\\u306B\\u623B\\u308B\"}),/*#__PURE__*/_jsxs(\"h3\",{children:[record.wine_type,\" \\u30C6\\u30A4\\u30B9\\u30C6\\u30A3\\u30F3\\u30B0\\u8A73\\u7D30 (\",record.summary.vintage,\")\"]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\u4FDD\\u5B58\\u65E5\\u6642:\"}),\" \",new Date(record.timestamp).toLocaleString()]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\u751F\\u7523\\u8005:\"}),\" \",record.summary.producer]}),/*#__PURE__*/_jsx(DetailList,{children:Object.entries(data).map(_ref2=>{let[key,value]=_ref2;return/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsxs(\"strong\",{children:[key,\":\"]}),\" \",Array.isArray(value)?value.join(', '):value]},key);})})]});};if(loading)return/*#__PURE__*/_jsx(HistoryContainer,{children:\"\\u5C65\\u6B74\\u3092\\u30ED\\u30FC\\u30C9\\u4E2D...\"});if(!user)return/*#__PURE__*/_jsx(HistoryContainer,{children:\"\\u5C65\\u6B74\\u3092\\u8868\\u793A\\u3059\\u308B\\u306B\\u306F\\u30ED\\u30B0\\u30A4\\u30F3\\u304C\\u5FC5\\u8981\\u3067\\u3059\\u3002\"});return/*#__PURE__*/_jsx(HistoryContainer,{children:selectedRecord?renderRecordDetails(selectedRecord):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"h2\",{children:[\"\\u30C6\\u30A4\\u30B9\\u30C6\\u30A3\\u30F3\\u30B0\\u5C65\\u6B74 (\",allRecords.length,\"\\u4EF6)\"]}),/*#__PURE__*/_jsx(SearchInput,{placeholder:\"\\u53CE\\u7A6B\\u5E74\\u3001\\u751F\\u7523\\u8005\\u3001\\u30BF\\u30A4\\u30D7\\u3067\\u691C\\u7D22...\",value:searchTerm,onChange:e=>setSearchTerm(e.target.value)}),filteredRecords.length===0&&/*#__PURE__*/_jsx(\"p\",{children:\"\\u5C65\\u6B74\\u304C\\u3042\\u308A\\u307E\\u305B\\u3093\\u3001\\u307E\\u305F\\u306F\\u691C\\u7D22\\u7D50\\u679C\\u304C\\u898B\\u3064\\u304B\\u308A\\u307E\\u305B\\u3093\\u3067\\u3057\\u305F\\u3002\"}),filteredRecords.map(record=>/*#__PURE__*/_jsxs(RecordCard,{wineType:record.wine_type==='白ワイン'?'white':'red',onClick:()=>setSelectedRecord(record),children:[/*#__PURE__*/_jsxs(\"h4\",{children:[record.summary.type,\" (\",record.wine_type,\")\"]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:record.summary.producer}),\" / \",record.summary.vintage]}),/*#__PURE__*/_jsx(\"p\",{style:{fontSize:'12px',color:'#666'},children:new Date(record.timestamp).toLocaleDateString()})]},record.id))]})});};export default HistoryView;","map":{"version":3,"names":["React","useState","useEffect","useCallback","fetchTastingRecords","styled","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","HistoryContainer","div","_templateObject","_taggedTemplateLiteral","SearchInput","input","_templateObject2","RecordCard","_templateObject3","props","wineType","DetailList","ul","_templateObject4","HistoryView","_ref","user","allRecords","setAllRecords","filteredRecords","setFilteredRecords","searchTerm","setSearchTerm","selectedRecord","setSelectedRecord","loading","setLoading","loadRecords","records","uid","error","console","term","toLowerCase","filtered","filter","record","summary","concise_summary","searchableText","producer","vintage","type","wine_type","join","includes","renderRecordDetails","data","full_tasting_data","sections","children","onClick","Date","timestamp","toLocaleString","Object","entries","map","_ref2","key","value","Array","isArray","length","placeholder","onChange","e","target","style","fontSize","color","toLocaleDateString","id"],"sources":["/workspaces/winetasting/src/components/HistoryView.js"],"sourcesContent":["import React, { useState, useEffect, useCallback } from 'react';\nimport { fetchTastingRecords } from '../utils/Firestore';\nimport styled from 'styled-components';\n// ======================= スタイル定義 =======================\nconst HistoryContainer = styled.div`\n  padding: 20px;\n  padding-bottom: 80px;\n`;\nconst SearchInput = styled.input`\n    width: 100%;\n    padding: 12px;\n    margin-bottom: 20px;\n    border: 1px solid #ccc;\n    border-radius: 8px;\n    box-sizing: border-box;\n`;\nconst RecordCard = styled.div`\n    background: ${props => props.wineType === 'white' ? '#fff8e1' : '#fbe5e7'};\n    border: 1px solid #eee;\n    padding: 15px;\n    margin-bottom: 10px;\n    border-radius: 10px;\n    box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n    cursor: pointer;\n`;\nconst DetailList = styled.ul`\n    list-style: none;\n    padding: 0;\n    margin-top: 15px;\n    border-top: 1px solid #ddd;\n    padding-top: 10px;\n    font-size: 14px;\n`;\n// ========================================================\n\nconst HistoryView = ({ user }) => {\n    const [allRecords, setAllRecords] = useState([]);\n    const [filteredRecords, setFilteredRecords] = useState([]);\n    const [searchTerm, setSearchTerm] = useState('');\n    const [selectedRecord, setSelectedRecord] = useState(null);\n    const [loading, setLoading] = useState(true);\n\n    // 1. 履歴の読み込み\n    const loadRecords = useCallback(async () => {\n        if (!user) return;\n        setLoading(true);\n        try {\n            const records = await fetchTastingRecords(user.uid);\n            setAllRecords(records);\n            setFilteredRecords(records);\n        } catch (error) {\n            console.error(\"履歴の読み込みエラー:\", error);\n        } finally {\n            setLoading(false);\n        }\n    }, [user]);\n\n    useEffect(() => {\n        loadRecords();\n    }, [loadRecords]);\n\n    // 2. 検索・フィルタリングロジック\n    useEffect(() => {\n        const term = searchTerm.toLowerCase();\n        const filtered = allRecords.filter(record => {\n            const summary = record.concise_summary;\n            \n            // 検索対象フィールド\n            const searchableText = [\n                summary.producer, \n                summary.vintage, \n                summary.type,\n                record.wine_type // 白ワイン/赤ワイン\n            ].join(' ').toLowerCase();\n\n            return searchableText.includes(term);\n        });\n        setFilteredRecords(filtered);\n    }, [searchTerm, allRecords]);\n    \n    // 3. 詳細レコードの表示レンダリング\n    const renderRecordDetails = (record) => {\n        if (!record) return null;\n        \n        // データをセクションごとに分類して表示\n        const data = record.full_tasting_data;\n        const sections = {}; // { 'Appearance': { '濃淡': '淡い', ... }, ... }\n\n        // フルデータからセクションを再構築するロジック (省略)\n        // ここでは簡単にフラットリストで表示します\n        \n        return (\n            <div>\n                <button onClick={() => setSelectedRecord(null)}>← 履歴一覧に戻る</button>\n                <h3>{record.wine_type} テイスティング詳細 ({record.summary.vintage})</h3>\n                <p><strong>保存日時:</strong> {new Date(record.timestamp).toLocaleString()}</p>\n                <p><strong>生産者:</strong> {record.summary.producer}</p>\n                \n                <DetailList>\n                    {Object.entries(data).map(([key, value]) => (\n                        <li key={key}>\n                            <strong>{key}:</strong> {Array.isArray(value) ? value.join(', ') : value}\n                        </li>\n                    ))}\n                </DetailList>\n            </div>\n        );\n    };\n\n    if (loading) return <HistoryContainer>履歴をロード中...</HistoryContainer>;\n    if (!user) return <HistoryContainer>履歴を表示するにはログインが必要です。</HistoryContainer>;\n\n    return (\n        <HistoryContainer>\n            {selectedRecord ? (\n                renderRecordDetails(selectedRecord)\n            ) : (\n                <>\n                    <h2>テイスティング履歴 ({allRecords.length}件)</h2>\n                    <SearchInput \n                        placeholder=\"収穫年、生産者、タイプで検索...\" \n                        value={searchTerm} \n                        onChange={(e) => setSearchTerm(e.target.value)}\n                    />\n\n                    {filteredRecords.length === 0 && <p>履歴がありません、または検索結果が見つかりませんでした。</p>}\n\n                    {filteredRecords.map(record => (\n                        <RecordCard \n                            key={record.id} \n                            wineType={record.wine_type === '白ワイン' ? 'white' : 'red'}\n                            onClick={() => setSelectedRecord(record)}\n                        >\n                            <h4>{record.summary.type} ({record.wine_type})</h4>\n                            <p><strong>{record.summary.producer}</strong> / {record.summary.vintage}</p>\n                            <p style={{ fontSize: '12px', color: '#666' }}>{new Date(record.timestamp).toLocaleDateString()}</p>\n                        </RecordCard>\n                    ))}\n                </>\n            )}\n        </HistoryContainer>\n    );\n};\n\nexport default HistoryView;\n"],"mappings":"oMAAA,MAAO,CAAAA,KAAK,EAAIC,QAAQ,CAAEC,SAAS,CAAEC,WAAW,KAAQ,OAAO,CAC/D,OAASC,mBAAmB,KAAQ,oBAAoB,CACxD,MAAO,CAAAC,MAAM,KAAM,mBAAmB,CACtC;AAAA,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,CAAAC,QAAA,IAAAC,SAAA,yBACA,KAAM,CAAAC,gBAAgB,CAAGP,MAAM,CAACQ,GAAG,CAAAC,eAAA,GAAAA,eAAA,CAAAC,sBAAA,qDAGlC,CACD,KAAM,CAAAC,WAAW,CAAGX,MAAM,CAACY,KAAK,CAAAC,gBAAA,GAAAA,gBAAA,CAAAH,sBAAA,6JAO/B,CACD,KAAM,CAAAI,UAAU,CAAGd,MAAM,CAACQ,GAAG,CAAAO,gBAAA,GAAAA,gBAAA,CAAAL,sBAAA,wMACXM,KAAK,EAAIA,KAAK,CAACC,QAAQ,GAAK,OAAO,CAAG,SAAS,CAAG,SAAS,CAO5E,CACD,KAAM,CAAAC,UAAU,CAAGlB,MAAM,CAACmB,EAAE,CAAAC,gBAAA,GAAAA,gBAAA,CAAAV,sBAAA,wJAO3B,CACD;AAEA,KAAM,CAAAW,WAAW,CAAGC,IAAA,EAAc,IAAb,CAAEC,IAAK,CAAC,CAAAD,IAAA,CACzB,KAAM,CAACE,UAAU,CAAEC,aAAa,CAAC,CAAG7B,QAAQ,CAAC,EAAE,CAAC,CAChD,KAAM,CAAC8B,eAAe,CAAEC,kBAAkB,CAAC,CAAG/B,QAAQ,CAAC,EAAE,CAAC,CAC1D,KAAM,CAACgC,UAAU,CAAEC,aAAa,CAAC,CAAGjC,QAAQ,CAAC,EAAE,CAAC,CAChD,KAAM,CAACkC,cAAc,CAAEC,iBAAiB,CAAC,CAAGnC,QAAQ,CAAC,IAAI,CAAC,CAC1D,KAAM,CAACoC,OAAO,CAAEC,UAAU,CAAC,CAAGrC,QAAQ,CAAC,IAAI,CAAC,CAE5C;AACA,KAAM,CAAAsC,WAAW,CAAGpC,WAAW,CAAC,SAAY,CACxC,GAAI,CAACyB,IAAI,CAAE,OACXU,UAAU,CAAC,IAAI,CAAC,CAChB,GAAI,CACA,KAAM,CAAAE,OAAO,CAAG,KAAM,CAAApC,mBAAmB,CAACwB,IAAI,CAACa,GAAG,CAAC,CACnDX,aAAa,CAACU,OAAO,CAAC,CACtBR,kBAAkB,CAACQ,OAAO,CAAC,CAC/B,CAAE,MAAOE,KAAK,CAAE,CACZC,OAAO,CAACD,KAAK,CAAC,aAAa,CAAEA,KAAK,CAAC,CACvC,CAAC,OAAS,CACNJ,UAAU,CAAC,KAAK,CAAC,CACrB,CACJ,CAAC,CAAE,CAACV,IAAI,CAAC,CAAC,CAEV1B,SAAS,CAAC,IAAM,CACZqC,WAAW,CAAC,CAAC,CACjB,CAAC,CAAE,CAACA,WAAW,CAAC,CAAC,CAEjB;AACArC,SAAS,CAAC,IAAM,CACZ,KAAM,CAAA0C,IAAI,CAAGX,UAAU,CAACY,WAAW,CAAC,CAAC,CACrC,KAAM,CAAAC,QAAQ,CAAGjB,UAAU,CAACkB,MAAM,CAACC,MAAM,EAAI,CACzC,KAAM,CAAAC,OAAO,CAAGD,MAAM,CAACE,eAAe,CAEtC;AACA,KAAM,CAAAC,cAAc,CAAG,CACnBF,OAAO,CAACG,QAAQ,CAChBH,OAAO,CAACI,OAAO,CACfJ,OAAO,CAACK,IAAI,CACZN,MAAM,CAACO,SAAU;AAAA,CACpB,CAACC,IAAI,CAAC,GAAG,CAAC,CAACX,WAAW,CAAC,CAAC,CAEzB,MAAO,CAAAM,cAAc,CAACM,QAAQ,CAACb,IAAI,CAAC,CACxC,CAAC,CAAC,CACFZ,kBAAkB,CAACc,QAAQ,CAAC,CAChC,CAAC,CAAE,CAACb,UAAU,CAAEJ,UAAU,CAAC,CAAC,CAE5B;AACA,KAAM,CAAA6B,mBAAmB,CAAIV,MAAM,EAAK,CACpC,GAAI,CAACA,MAAM,CAAE,MAAO,KAAI,CAExB;AACA,KAAM,CAAAW,IAAI,CAAGX,MAAM,CAACY,iBAAiB,CACrC,KAAM,CAAAC,QAAQ,CAAG,CAAC,CAAC,CAAE;AAErB;AACA;AAEA,mBACIpD,KAAA,QAAAqD,QAAA,eACIvD,IAAA,WAAQwD,OAAO,CAAEA,CAAA,GAAM3B,iBAAiB,CAAC,IAAI,CAAE,CAAA0B,QAAA,CAAC,mDAAS,CAAQ,CAAC,cAClErD,KAAA,OAAAqD,QAAA,EAAKd,MAAM,CAACO,SAAS,CAAC,2DAAY,CAACP,MAAM,CAACC,OAAO,CAACI,OAAO,CAAC,GAAC,EAAI,CAAC,cAChE5C,KAAA,MAAAqD,QAAA,eAAGvD,IAAA,WAAAuD,QAAA,CAAQ,2BAAK,CAAQ,CAAC,IAAC,CAAC,GAAI,CAAAE,IAAI,CAAChB,MAAM,CAACiB,SAAS,CAAC,CAACC,cAAc,CAAC,CAAC,EAAI,CAAC,cAC3EzD,KAAA,MAAAqD,QAAA,eAAGvD,IAAA,WAAAuD,QAAA,CAAQ,qBAAI,CAAQ,CAAC,IAAC,CAACd,MAAM,CAACC,OAAO,CAACG,QAAQ,EAAI,CAAC,cAEtD7C,IAAA,CAACgB,UAAU,EAAAuC,QAAA,CACNK,MAAM,CAACC,OAAO,CAACT,IAAI,CAAC,CAACU,GAAG,CAACC,KAAA,MAAC,CAACC,GAAG,CAAEC,KAAK,CAAC,CAAAF,KAAA,oBACnC7D,KAAA,OAAAqD,QAAA,eACIrD,KAAA,WAAAqD,QAAA,EAASS,GAAG,CAAC,GAAC,EAAQ,CAAC,IAAC,CAACE,KAAK,CAACC,OAAO,CAACF,KAAK,CAAC,CAAGA,KAAK,CAAChB,IAAI,CAAC,IAAI,CAAC,CAAGgB,KAAK,GADnED,GAEL,CAAC,EACR,CAAC,CACM,CAAC,EACZ,CAAC,CAEd,CAAC,CAED,GAAIlC,OAAO,CAAE,mBAAO9B,IAAA,CAACK,gBAAgB,EAAAkD,QAAA,CAAC,+CAAU,CAAkB,CAAC,CACnE,GAAI,CAAClC,IAAI,CAAE,mBAAOrB,IAAA,CAACK,gBAAgB,EAAAkD,QAAA,CAAC,oHAAmB,CAAkB,CAAC,CAE1E,mBACIvD,IAAA,CAACK,gBAAgB,EAAAkD,QAAA,CACZ3B,cAAc,CACXuB,mBAAmB,CAACvB,cAAc,CAAC,cAEnC1B,KAAA,CAAAE,SAAA,EAAAmD,QAAA,eACIrD,KAAA,OAAAqD,QAAA,EAAI,0DAAW,CAACjC,UAAU,CAAC8C,MAAM,CAAC,SAAE,EAAI,CAAC,cACzCpE,IAAA,CAACS,WAAW,EACR4D,WAAW,CAAC,yFAAmB,CAC/BJ,KAAK,CAAEvC,UAAW,CAClB4C,QAAQ,CAAGC,CAAC,EAAK5C,aAAa,CAAC4C,CAAC,CAACC,MAAM,CAACP,KAAK,CAAE,CAClD,CAAC,CAEDzC,eAAe,CAAC4C,MAAM,GAAK,CAAC,eAAIpE,IAAA,MAAAuD,QAAA,CAAG,0KAA4B,CAAG,CAAC,CAEnE/B,eAAe,CAACsC,GAAG,CAACrB,MAAM,eACvBvC,KAAA,CAACU,UAAU,EAEPG,QAAQ,CAAE0B,MAAM,CAACO,SAAS,GAAK,MAAM,CAAG,OAAO,CAAG,KAAM,CACxDQ,OAAO,CAAEA,CAAA,GAAM3B,iBAAiB,CAACY,MAAM,CAAE,CAAAc,QAAA,eAEzCrD,KAAA,OAAAqD,QAAA,EAAKd,MAAM,CAACC,OAAO,CAACK,IAAI,CAAC,IAAE,CAACN,MAAM,CAACO,SAAS,CAAC,GAAC,EAAI,CAAC,cACnD9C,KAAA,MAAAqD,QAAA,eAAGvD,IAAA,WAAAuD,QAAA,CAASd,MAAM,CAACC,OAAO,CAACG,QAAQ,CAAS,CAAC,MAAG,CAACJ,MAAM,CAACC,OAAO,CAACI,OAAO,EAAI,CAAC,cAC5E9C,IAAA,MAAGyE,KAAK,CAAE,CAAEC,QAAQ,CAAE,MAAM,CAAEC,KAAK,CAAE,MAAO,CAAE,CAAApB,QAAA,CAAE,GAAI,CAAAE,IAAI,CAAChB,MAAM,CAACiB,SAAS,CAAC,CAACkB,kBAAkB,CAAC,CAAC,CAAI,CAAC,GAN/FnC,MAAM,CAACoC,EAOJ,CACf,CAAC,EACJ,CACL,CACa,CAAC,CAE3B,CAAC,CAED,cAAe,CAAA1D,WAAW","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}