{"ast":null,"code":"import _objectSpread from\"/workspaces/winetasting/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import{db}from'../firebaseConfig';import{doc,collection,addDoc,query,where,getDocs,setDoc,getDoc}from'firebase/firestore';/**\n * テイスティング結果をFirestoreに保存\n * @param {object} userData - {uid: string, ...}\n * @param {object} recordData - テイスティングフォームの全データ\n */export const saveTastingRecord=async(userData,recordData)=>{const recordRef=collection(db,'tasting_records',userData.uid,'records');const timestamp=new Date().toISOString();const record={timestamp:timestamp,wine_type:recordData.wine_type,concise_summary:recordData.summary,// 検索用サマリー\nfull_tasting_data:recordData.full_data// 全詳細データ\n};try{await addDoc(recordRef,record);console.log(\"Record saved successfully!\");}catch(e){console.error(\"Error adding document: \",e);throw new Error(\"履歴の保存に失敗しました。\");}};/**\n * ユーザーの全履歴を読み込み\n */export const fetchTastingRecords=async uid=>{if(!uid)return[];const recordsRef=collection(db,'tasting_records',uid,'records');const q=query(recordsRef);const snapshot=await getDocs(q);const records=snapshot.docs.map(doc=>_objectSpread({id:doc.id},doc.data()));return records.sort((a,b)=>b.timestamp.localeCompare(a.timestamp));// 新しい順にソート\n};/**\n * ユーザーのカスタムオプション（品種・生産国）を読み込み\n */export const fetchCustomOptions=async uid=>{if(!uid)return null;const docRef=doc(db,'user_settings',uid);const docSnap=await getDoc(docRef);if(docSnap.exists()){return docSnap.data().customOptions||{};}return{};};/**\n * ユーザーのカスタムオプション（品種・生産国）を保存/更新\n */export const saveCustomOptions=async(uid,newOptions)=>{if(!uid)throw new Error(\"UID is required for saving options.\");const docRef=doc(db,'user_settings',uid);await setDoc(docRef,{customOptions:newOptions},{merge:true});};","map":{"version":3,"names":["db","doc","collection","addDoc","query","where","getDocs","setDoc","getDoc","saveTastingRecord","userData","recordData","recordRef","uid","timestamp","Date","toISOString","record","wine_type","concise_summary","summary","full_tasting_data","full_data","console","log","e","error","Error","fetchTastingRecords","recordsRef","q","snapshot","records","docs","map","_objectSpread","id","data","sort","a","b","localeCompare","fetchCustomOptions","docRef","docSnap","exists","customOptions","saveCustomOptions","newOptions","merge"],"sources":["/workspaces/winetasting/src/utils/Firestore.js"],"sourcesContent":["import { db } from '../firebaseConfig';\nimport { \n  doc, \n  collection, \n  addDoc, \n  query, \n  where, \n  getDocs, \n  setDoc,\n  getDoc\n} from 'firebase/firestore';\n\n/**\n * テイスティング結果をFirestoreに保存\n * @param {object} userData - {uid: string, ...}\n * @param {object} recordData - テイスティングフォームの全データ\n */\nexport const saveTastingRecord = async (userData, recordData) => {\n  const recordRef = collection(db, 'tasting_records', userData.uid, 'records');\n  const timestamp = new Date().toISOString();\n  \n  const record = {\n    timestamp: timestamp,\n    wine_type: recordData.wine_type,\n    concise_summary: recordData.summary, // 検索用サマリー\n    full_tasting_data: recordData.full_data, // 全詳細データ\n  };\n\n  try {\n    await addDoc(recordRef, record);\n    console.log(\"Record saved successfully!\");\n  } catch (e) {\n    console.error(\"Error adding document: \", e);\n    throw new Error(\"履歴の保存に失敗しました。\");\n  }\n};\n\n/**\n * ユーザーの全履歴を読み込み\n */\nexport const fetchTastingRecords = async (uid) => {\n  if (!uid) return [];\n  const recordsRef = collection(db, 'tasting_records', uid, 'records');\n  const q = query(recordsRef);\n  \n  const snapshot = await getDocs(q);\n  const records = snapshot.docs.map(doc => ({\n    id: doc.id,\n    ...doc.data()\n  }));\n  return records.sort((a, b) => b.timestamp.localeCompare(a.timestamp)); // 新しい順にソート\n};\n\n\n/**\n * ユーザーのカスタムオプション（品種・生産国）を読み込み\n */\nexport const fetchCustomOptions = async (uid) => {\n    if (!uid) return null;\n    const docRef = doc(db, 'user_settings', uid);\n    const docSnap = await getDoc(docRef);\n\n    if (docSnap.exists()) {\n        return docSnap.data().customOptions || {};\n    }\n    return {};\n};\n\n/**\n * ユーザーのカスタムオプション（品種・生産国）を保存/更新\n */\nexport const saveCustomOptions = async (uid, newOptions) => {\n    if (!uid) throw new Error(\"UID is required for saving options.\");\n    const docRef = doc(db, 'user_settings', uid);\n    \n    await setDoc(docRef, { customOptions: newOptions }, { merge: true });\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}